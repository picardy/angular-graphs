"use strict";angular.module("picardy.graphs.line",["picardy.graphs.common"]).directive("d3GraphLine",["common","$rootScope",function(a,b){function c(b,c){function d(a){return h.colors&&h.colors[a]?h.colors[a]:"black"}function e(){var a,b;a=d3.svg.axis().scale(p).ticks(d3.time.days,3).tickFormat(d3.time.format("%a %d")).orient("bottom"),s.append("g").attr("class","x axis").attr("transform","translate("+m.left+","+o+")").call(a).selectAll("text").style("fill",d("axes")).attr("transform","translate(0,10)"),b=d3.svg.axis().scale(q).orient("left"),s.append("g").attr("class","y axis").attr("transform","translate("+m.left+",0)").call(b).selectAll("text").style("fill",d("axes")),s.selectAll(".axis path, .axis line").style("fill","none").style("stroke",d("axes")).style("shape-rendering","crispEdges")}function f(){r.append("text").attr("transform","rotate(-90) translate(0,"+(m.left+20)+")").style({"text-anchor":"end",fill:d("labels")}).text("Completion (%)")}function g(a,b){var c,e,f;f=d3.svg.line().interpolate("linear").x(function(a){return p(a.x)}).y(function(a){return q(a.y)}),c=t.append("path").datum(i).attr("transform","translate("+m.left+",0)").attr("class","line").attr("d",f),e=c.node().getTotalLength(),c.attr("stroke-dasharray",e+" "+e).attr("stroke-dashoffset",e).transition().duration(b).delay(a).ease("linear").attr("stroke-dashoffset",0),t.selectAll(".line").style("fill","none").style("stroke",d("lines")).style("stroke-width","1.5px")}var h,i,j,k,l,m,n,o,p,q,r,s,t;b.data&&(h=angular.copy(b.data),i=[],j={height:void 0===b.height?300:b.height,delay:void 0===b.delay?500:b.delay,duration:void 0===b.duration?1e3:b.duration},j.width=void 0===b.width?2*j.height:b.width,k=a.initSvg(c[0],j.width,j.height),r=k.append("g").attr("class","labels"),s=k.append("g").attr("class","axes"),t=k.append("g").attr("class","lines"),m={top:20,right:20,bottom:30,left:50},n=j.width-m.left-m.right,o=j.height-m.top-m.bottom,l=d3.time.format("%d-%b-%y").parse,angular.forEach(h.x,function(a,b){i.push({x:l(a),y:h.y[b]})}),p=d3.time.scale().range([0,n-20]),q=d3.scale.linear().range([o,20]),p.domain(d3.extent(i,function(a){return a.x})),q.domain([0,d3.max(i,function(a){return a.y})]),k.attr("width",n+m.left+m.right).attr("height",o+m.top+m.bottom),e(),f(),g(j.delay,j.duration))}return{restrict:"E",scope:{render:"=",data:"=",width:"@",height:"@",duration:"@",delay:"@"},link:function(a,d,e){b[e.render]=function(b){a.data=b,c(a,d,e)}}}}]),angular.module("picardy.graphs.pie",["picardy.graphs.common"]).directive("d3GraphPie",["common","$rootScope",function(a,b){function c(b,c){function d(a,b){return j.colors&&j.colors[a]?"slices"===a?j.colors.slices?j.colors.slices[b]:d3.scale.category10().range()[b]:j.colors[a]:"black"}function e(a){return a.data.label}function f(a,b){var c=n.selectAll("path.slice").data(t(a),e);b||(b=0),c.enter().insert("path").style("fill",function(a){return a.data.color}).attr("class","slice"),c.transition().duration(b).attrTween("d",function(a){var b;return this._current=this._current||a,b=d3.interpolate(this._current,a),function(a){var c=b(a);return w.text(Math.round(c.value)+"%"),u(c)}})}function g(a){return a.startAngle+(a.endAngle-a.startAngle)/2}function h(a){var b=p.selectAll("polyline").data(t(a),e);b.enter().append("polyline").style({opacity:"0.3",stroke:d("lines"),"stroke-width":"2px",fill:"none"}).attr("points",function(a){var b=v.centroid(a);return b[0]=.95*s*(g(a)<Math.PI?1:-1),[u.centroid(a),v.centroid(a),b]}),b.exit().remove()}function i(a){var b=o.selectAll("text").data(t(a),e);b.enter().append("text").attr("dy",".35em").style("fill",d("labels")).text(function(a){return a.data.label}).attr("transform",function(a){var b=v.centroid(a);return b[0]=s*(g(a)<Math.PI?1:-1),"translate("+b+")"}).style("text-anchor",function(a){return g(a)<Math.PI?"start":"end"})}var j,k,l,m,n,o,p,q,r,s,t,u,v,w;b.data&&(j=angular.copy(b.data),k={start:[],end:[]},l={labels:j.labels&&j.labels.length,height:void 0===j.width?300:j.width,delay:void 0===j.delay?500:j.delay,duration:void 0===j.duration?1e3:j.duration},l.width=void 0===j.width?l.height+(l.labels?200:0):j.width,m=a.initSvg(c[0],l.width,l.height),angular.forEach(j.start,function(a,b){var c=l.labels?j.labels[b]:Math.random(),e=d("slices",b);k.start.push({value:j.start[b],label:c,color:e}),k.end.push({value:j.end[b],label:c,color:e})}),l.pieWidth=300,l.pieHeight=300,n=m.append("g").attr("class","slices"),o=m.append("g").attr("class","labels"),p=m.append("g").attr("class","lines"),q=m.append("g").attr("class","text"),m.selectAll("g").attr("transform",function(){return"translate("+l.width/2+","+l.height/2+")"}),r=Math.min(l.pieWidth,l.pieHeight),s=r/2,t=d3.layout.pie().value(function(a){return a.value}).sort(null),u=d3.svg.arc().outerRadius(.8*s).innerRadius(.4*s),v=d3.svg.arc().innerRadius(.9*s).outerRadius(.9*s),w=q.append("text").attr("text-anchor","middle").attr("alignment-baseline","central").attr({style:"font-size: "+l.pieWidth/6+"px",fill:d("amount")}),f(k.start),setTimeout(function(){f(k.end,l.duration),l.labels&&setTimeout(function(){h(k.end),i(k.end)},l.duration)},l.delay))}return{restrict:"E",scope:{render:"=",data:"="},link:function(a,d,e){b[e.render]=function(b){a.data=b,c(a,d,e)}}}}]),angular.module("picardy.graphs.common",[]).factory("common",function(){return{readOptions:function(a,b,c){function d(a,b){return void 0===a?b:a}return{delay:d(c.delay,500),duration:d(c.duration,1e3)}},initSvg:function(a,b,c){return d3.select(a).append("svg").attr("viewBox",[0,0,b,c].join(" "))}}});
"use strict";angular.module("picardy.graphs.line",["picardy.graphs.common"]).directive("d3GraphLine",["common",function(a){return{restrict:"E",scope:{type:"@",height:"@",width:"@",radius:"@"},link:function(b,c,d){var e,f,g,h,i,j,k,l,m,n,o,p=a.readOptions(b,c,d),q=a.initSvg(c[0],p.width,p.height),r=d3.time.format("%d-%b-%y").parse;e=[{date:"13-Oct-13",count:10},{date:"17-Oct-13",count:13},{date:"18-Oct-13",count:18},{date:"18-Oct-13",count:35},{date:"21-Oct-13",count:10},{date:"26-Oct-13",count:13},{date:"27-Oct-13",count:18}],f={top:20,right:20,bottom:30,left:50},g=p.width-f.left-f.right,h=p.height-f.top-f.bottom,i=d3.time.scale().range([0,g-20]),j=d3.scale.linear().range([h,20]),k=d3.svg.axis().scale(i).ticks(d3.time.days,3).tickFormat(d3.time.format("%a %d")).tickSize(0).orient("bottom"),l=d3.svg.axis().scale(j).orient("left"),m=d3.svg.line().interpolate("linear").x(function(a){return i(a.date)}).y(function(a){return j(a.count)}),e.forEach(function(a){a.date=r(a.date),a.count=+a.count}),i.domain(d3.extent(e,function(a){return a.date})),j.domain([0,d3.max(e,function(a){return a.count})]),q.attr("width",g+f.left+f.right).attr("heigh",h+f.top+f.bottom).append("g").attr("transform","translate("+f.left+", "+f.top+")"),q.append("g").attr("class","x axis").attr("transform","translate("+f.left+","+h+")").call(k).selectAll("text").attr("transform","translate(0,10)"),q.append("g").attr("class","y axis").attr("transform","translate("+f.left+",0)").call(l).append("text").attr("transform","rotate(-90) translate(0, 20)").style("text-anchor","end").text("Price ($)"),n=q.append("path").datum(e).attr("transform","translate("+f.left+",0)").attr("class","line").attr("d",m),o=n.node().getTotalLength(),n.attr("stroke-dasharray",o+" "+o).attr("stroke-dashoffset",o).transition().duration(1e3).delay(p.delay).ease("cubic").attr("stroke-dashoffset",0),q.selectAll(".axis path, .axis line").style("fill","none").style("stroke","#000000").style("shape-rendering","crispEdges"),q.selectAll(".line").style("fill","none").style("stroke","red").style("stroke-width","1.5px")}}}]),angular.module("picardy.graphs.pie",["picardy.graphs.common"]).directive("d3GraphPie",["common",function(a){return{restrict:"E",scope:{data:"=",labels:"=",height:"@",width:"@",radius:"@"},link:function(b,c,d){function e(a){return a.data.label}function f(a,b){var c=n.selectAll("path.slice").data(t(a),e);b||(b=0),c.enter().insert("path").style("fill",function(a){return a.data.color}).attr("class","slice"),c.transition().duration(b).attrTween("d",function(a){var b;return this._current=this._current||a,b=d3.interpolate(this._current,a),function(a){var c=b(a);return w.text(Math.round(c.value)+"%"),u(c)}})}function g(a){return a.startAngle+(a.endAngle-a.startAngle)/2}function h(a){var b=p.selectAll("polyline").data(t(a),e);b.enter().append("polyline").style({opacity:"0.3",stroke:"black","stroke-width":"2px",fill:"none"}).attr("points",function(a){var b=v.centroid(a);return b[0]=.95*s*(g(a)<Math.PI?1:-1),[u.centroid(a),v.centroid(a),b]}),b.exit().remove()}function i(a){var b=o.selectAll("text").data(t(a),e);b.enter().append("text").attr("dy",".35em").text(function(a){return a.data.label}).attr("transform",function(a){var b=v.centroid(a);return b[0]=s*(g(a)<Math.PI?1:-1),"translate("+b+")"}).style("text-anchor",function(a){return g(a)<Math.PI?"start":"end"})}var j,k,l,m,n,o,p,q,r,s,t,u,v,w;b.data&&(j=angular.copy(b.data),k={start:[],end:[]},l=a.readOptions(b,c,d),m=a.initSvg(c[0],l.width,l.height),j.colors||(j.colors=d3.scale.category10().range()),angular.forEach(j.start,function(a,b){var c=j.labels[b],d=j.colors[b];k.start.push({value:j.start[b],label:c,color:d}),k.end.push({value:j.end[b],label:c,color:d})}),l.pieWidth=d.pieWidth,l.pieHeight=d.pieHeight,n=m.append("g").attr("class","slices"),o=m.append("g").attr("class","labels"),p=m.append("g").attr("class","lines"),q=m.append("g").attr("class","text"),m.selectAll("g").attr("transform",function(){return"translate("+l.width/2+","+l.height/2+")"}),r=Math.min(l.pieWidth,l.pieHeight),s=r/2,t=d3.layout.pie().value(function(a){return a.value}).sort(null),u=d3.svg.arc().outerRadius(.8*s).innerRadius(.4*s),v=d3.svg.arc().innerRadius(.9*s).outerRadius(.9*s),w=q.append("text").attr("text-anchor","middle").attr("alignment-baseline","central").attr("style","font-size: "+l.pieWidth/6+"px"),f(k.start),setTimeout(function(){k.end[0].value=20,k.end[1].value=80,f(k.end,l.duration),b.labels&&setTimeout(function(){h(k.end),i(k.end)},l.duration)},l.delay))}}}]),angular.module("picardy.graphs.common",[]).factory("common",function(){return{readOptions:function(a,b,c){function d(a,b){return void 0===a?b:a}return{width:d(c.width,600),height:d(c.height,300),delay:d(c.delay,500),duration:d(c.duration,1e3)}},initSvg:function(a,b,c){return d3.select(a).append("svg").attr("width",b).attr("height",c)}}});
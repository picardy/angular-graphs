"use strict";angular.module("picardy.graphs.line",["picardy.graphs.common"]).directive("d3GraphLine",["common",function(a){return{restrict:"E",scope:{type:"@",height:"@",width:"@",radius:"@"},link:function(b,c,d){var e,f,g,h,i,j,k,l,m,n,o,p=a.readOptions(b,c,d),q=a.initSvg(c[0],p.width,p.height),r=d3.time.format("%d-%b-%y").parse;e=[{date:"13-Oct-13",count:10},{date:"17-Oct-13",count:13},{date:"18-Oct-13",count:18},{date:"18-Oct-13",count:35},{date:"21-Oct-13",count:10},{date:"26-Oct-13",count:13},{date:"27-Oct-13",count:18}],f={top:20,right:20,bottom:30,left:50},g=p.width-f.left-f.right,h=p.height-f.top-f.bottom,i=d3.time.scale().range([0,g-20]),j=d3.scale.linear().range([h,20]),k=d3.svg.axis().scale(i).ticks(d3.time.days,3).tickFormat(d3.time.format("%a %d")).tickSize(0).orient("bottom"),l=d3.svg.axis().scale(j).orient("left"),m=d3.svg.line().interpolate("linear").x(function(a){return i(a.date)}).y(function(a){return j(a.count)}),e.forEach(function(a){a.date=r(a.date),a.count=+a.count}),i.domain(d3.extent(e,function(a){return a.date})),j.domain([0,d3.max(e,function(a){return a.count})]),q.attr("width",g+f.left+f.right).attr("heigh",h+f.top+f.bottom).append("g").attr("transform","translate("+f.left+", "+f.top+")"),q.append("g").attr("class","x axis").attr("transform","translate("+f.left+","+h+")").call(k).selectAll("text").attr("transform","translate(0,10)"),q.append("g").attr("class","y axis").attr("transform","translate("+f.left+",0)").call(l).append("text").attr("transform","rotate(-90) translate(0, 20)").style("text-anchor","end").text("Price ($)"),n=q.append("path").datum(e).attr("transform","translate("+f.left+",0)").attr("class","line").attr("d",m),o=n.node().getTotalLength(),n.attr("stroke-dasharray",o+" "+o).attr("stroke-dashoffset",o).transition().duration(1e3).delay(p.delay).ease("cubic").attr("stroke-dashoffset",0),q.selectAll(".axis path, .axis line").style("fill","none").style("stroke","#000000").style("shape-rendering","crispEdges"),q.selectAll(".line").style("fill","none").style("stroke","red").style("stroke-width","1.5px")}}}]),angular.module("picardy.graphs.pie",["picardy.graphs.common"]).directive("d3GraphPie",["common",function(a){return{restrict:"E",scope:{data:"=",labels:"=",height:"@",width:"@",radius:"@"},link:function(b,c,d){function e(a){return a.data.label}function f(a,b){var c=j.selectAll("path.slice").data(p(a),e);b||(b=0),c.enter().insert("path").style("fill",function(a,b){return v(0===b?0:1)}).attr("class","slice"),c.transition().duration(b).attrTween("d",function(a){var b;return this._current=this._current||a,b=d3.interpolate(this._current,a),function(a){var c=b(a);return s.text(Math.round(c.value)+"%"),q(c)}})}function g(a){return a.startAngle+(a.endAngle-a.startAngle)/2}function h(a){var b=l.selectAll("polyline").data(p(a),e);b.enter().append("polyline").style({opacity:"0.3",stroke:"black","stroke-width":"2px",fill:"none"}).attr("points",function(a){var b=r.centroid(a);return b[0]=.95*o*(g(a)<Math.PI?1:-1),[q.centroid(a),r.centroid(a),b]}),b.exit().remove()}function i(a){var b=k.selectAll("text").data(p(a),e);b.enter().append("text").attr("dy",".35em").text(function(a){return a.data.label}).attr("transform",function(a){var b=r.centroid(a);return b[0]=o*(g(a)<Math.PI?1:-1),"translate("+b+")"}).style("text-anchor",function(a){return g(a)<Math.PI?"start":"end"})}var j,k,l,m,n,o,p,q,r,s,t=a.readOptions(b,c,d),u=a.initSvg(c[0],t.width,t.height),v=d3.scale.category10();t.pieWidth=d.pieWidth,t.pieHeight=d.pieHeight,j=u.append("g").attr("class","slices"),k=u.append("g").attr("class","labels"),l=u.append("g").attr("class","lines"),m=u.append("g").attr("class","text"),u.selectAll("g").attr("transform",function(){return"translate("+t.width/2+","+t.height/2+")"}),n=Math.min(t.pieWidth,t.pieHeight),o=n/2,p=d3.layout.pie().value(function(a){return a.value}).sort(null),q=d3.svg.arc().outerRadius(.8*o).innerRadius(.4*o),r=d3.svg.arc().innerRadius(.9*o).outerRadius(.9*o),s=m.append("text").attr("text-anchor","middle").attr("alignment-baseline","central").attr("style","font-size: "+t.pieWidth/6+"px"),f(b.data.start),setTimeout(function(){b.data.end[0].value=20,b.data.end[1].value=80,f(b.data.end,t.duration),b.labels&&setTimeout(function(){h(b.data.end),i(b.data.end)},t.duration)},t.delay)}}}]),angular.module("picardy.graphs.common",[]).factory("common",function(){return{readOptions:function(a,b,c){function d(a,b){return void 0===a?a:b}return{width:d(c.width,600),height:d(c.height,300),delay:d(c.delay,500),duration:d(c.duration,1e3)}},initSvg:function(a,b,c){return d3.select(a).append("svg").attr("width",b).attr("height",c)}}});
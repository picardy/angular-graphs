"use strict";angular.module("picardy.graphs.line",["picardy.graphs.common"]).directive("d3GraphLine",["common",function(a){return{restrict:"E",scope:{type:"@",height:"@",width:"@",radius:"@"},link:function(b,c,d){var e,f,g,h,i,j,k,l,m,n,o,p=a.readOptions(b,c,d),q=a.initSvg(c[0],p.width,p.height),r=d3.time.format("%d-%b-%y").parse;e=[{date:"13-Oct-13",count:10},{date:"17-Oct-13",count:13},{date:"18-Oct-13",count:18},{date:"18-Oct-13",count:35},{date:"21-Oct-13",count:10},{date:"26-Oct-13",count:13},{date:"27-Oct-13",count:18}],f={top:20,right:20,bottom:30,left:50},g=p.width-f.left-f.right,h=p.height-f.top-f.bottom,i=d3.time.scale().range([0,g-20]),j=d3.scale.linear().range([h,20]),k=d3.svg.axis().scale(i).ticks(d3.time.days,3).tickFormat(d3.time.format("%a %d")).tickSize(0).orient("bottom"),l=d3.svg.axis().scale(j).orient("left"),m=d3.svg.line().interpolate("linear").x(function(a){return i(a.date)}).y(function(a){return j(a.count)}),e.forEach(function(a){a.date=r(a.date),a.count=+a.count}),i.domain(d3.extent(e,function(a){return a.date})),j.domain([0,d3.max(e,function(a){return a.count})]),q.attr("width",g+f.left+f.right).attr("heigh",h+f.top+f.bottom).append("g").attr("transform","translate("+f.left+", "+f.top+")"),q.append("g").attr("class","x axis").attr("transform","translate("+f.left+","+h+")").call(k).selectAll("text").attr("transform","translate(0,10)"),q.append("g").attr("class","y axis").attr("transform","translate("+f.left+",0)").call(l).append("text").attr("transform","rotate(-90) translate(0, 20)").style("text-anchor","end").text("Price ($)"),n=q.append("path").datum(e).attr("transform","translate("+f.left+",0)").attr("class","line").attr("d",m),o=n.node().getTotalLength(),n.attr("stroke-dasharray",o+" "+o).attr("stroke-dashoffset",o).transition().duration(1e3).delay(p.delay).ease("cubic").attr("stroke-dashoffset",0),q.selectAll(".axis path, .axis line").style("fill","none").style("stroke","#000000").style("shape-rendering","crispEdges"),q.selectAll(".line").style("fill","none").style("stroke","red").style("stroke-width","1.5px")}}}]),angular.module("picardy.graphs.pie",["picardy.graphs.common"]).directive("d3GraphPie",["common","$rootScope",function(a,b){function c(b,c){function d(a){return a.data.label}function e(a,b){var c=m.selectAll("path.slice").data(s(a),d);b||(b=0),c.enter().insert("path").style("fill",function(a){return a.data.color}).attr("class","slice"),c.transition().duration(b).attrTween("d",function(a){var b;return this._current=this._current||a,b=d3.interpolate(this._current,a),function(a){var c=b(a);return v.text(Math.round(c.value)+"%"),t(c)}})}function f(a){return a.startAngle+(a.endAngle-a.startAngle)/2}function g(a){var b=o.selectAll("polyline").data(s(a),d);b.enter().append("polyline").style({opacity:"0.3",stroke:"black","stroke-width":"2px",fill:"none"}).attr("points",function(a){var b=u.centroid(a);return b[0]=.95*r*(f(a)<Math.PI?1:-1),[t.centroid(a),u.centroid(a),b]}),b.exit().remove()}function h(a){var b=n.selectAll("text").data(s(a),d);b.enter().append("text").attr("dy",".35em").text(function(a){return a.data.label}).attr("transform",function(a){var b=u.centroid(a);return b[0]=r*(f(a)<Math.PI?1:-1),"translate("+b+")"}).style("text-anchor",function(a){return f(a)<Math.PI?"start":"end"})}var i,j,k,l,m,n,o,p,q,r,s,t,u,v;b.data&&(i=angular.copy(b.data),j={start:[],end:[]},k={labels:b.labels===!0,width:b.labels?500:300,height:300,delay:void 0===b.delay?500:b.delay,duration:void 0===b.duration?1e3:b.duration},l=a.initSvg(c[0],k.width,k.height),i.colors||(i.colors=d3.scale.category10().range()),angular.forEach(i.start,function(a,b){var c=i.labels?i.labels[b]:Math.random(),d=i.colors[b];j.start.push({value:i.start[b],label:c,color:d}),j.end.push({value:i.end[b],label:c,color:d})}),k.pieWidth=300,k.pieHeight=300,m=l.append("g").attr("class","slices"),n=l.append("g").attr("class","labels"),o=l.append("g").attr("class","lines"),p=l.append("g").attr("class","text"),l.selectAll("g").attr("transform",function(){return"translate("+k.width/2+","+k.height/2+")"}),q=Math.min(k.pieWidth,k.pieHeight),r=q/2,s=d3.layout.pie().value(function(a){return a.value}).sort(null),t=d3.svg.arc().outerRadius(.8*r).innerRadius(.4*r),u=d3.svg.arc().innerRadius(.9*r).outerRadius(.9*r),v=p.append("text").attr("text-anchor","middle").attr("alignment-baseline","central").attr("style","font-size: "+k.pieWidth/6+"px"),e(j.start),setTimeout(function(){e(j.end,k.duration),k.labels&&setTimeout(function(){g(j.end),h(j.end)},k.duration)},k.delay))}return{restrict:"E",scope:{data:"=",labels:"=",height:"@",width:"@",radius:"@",init:"&",render:"="},link:function(a,d,e){b[e.render]=function(b){a.data=b,c(a,d,e)}}}}]),angular.module("picardy.graphs.common",[]).factory("common",function(){return{readOptions:function(a,b,c){function d(a,b){return void 0===a?b:a}return{delay:d(c.delay,500),duration:d(c.duration,1e3)}},initSvg:function(a,b,c){return d3.select(a).append("svg").attr("viewBox",[0,0,b,c].join(" "))}}});